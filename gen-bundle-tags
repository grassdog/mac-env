#! /usr/bin/env ruby

# Generate all tags for a project and its bundler gems
# Needs to be Ruby until bundler supports show of all gems in the bundle

require 'bundler'

paths = Bundler.load.specs.map(&:full_gem_path)

ruby_alias = '/.*alias(_method)?[[:space:]]+:([[:alnum:]_=!?]+),?[[:space:]]+:([[:alnum:]_=!]+)/\\2/f/'
command = "ctags -R --tag-relative=yes --totals=yes --extra=+f --fields=+iaS --regex-ruby=\"#{ruby_alias}\" --C-kinds=- --sql-kinds=- --exclude=.git --exclude=log -f .gems.tags"

system("#{command} #{paths.join(' ')}")
